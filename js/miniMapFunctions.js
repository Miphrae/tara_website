const sources={county1:{kml:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/borders_livermore.kml",csv:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/points_livermore.csv"},county2:{kml:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/borders_pleasanton.kml",csv:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/points_pleasanton.csv"},county3:{kml:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/borders.kml",csv:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/points.csv"}};function makePinIcon(e){return L.divIcon({html:`\n        <svg width="24" height="36" viewBox="0 0 24 36">\n          <path\n            d="M12 0C7.038 0 3 4.038 3 9\n               c0 7.5 9 27 9 27s9-19.5 9-27\n               C21 4.038 16.962 0 12 0z"\n            fill="${e}"/>\n          <circle cx="12" cy="9" r="3" fill="#fff"/>\n        </svg>`,className:"",iconSize:[24,36],iconAnchor:[12,36],popupAnchor:[0,-36]})}async function loadCounty(e,t,n,s,o,r,i){t._borders&&(t.removeLayer(t._borders),t._borders=null),n.clearLayers(),s.length=0,o.innerHTML="<p><em>Click a marker on the map â†’ its name will go here.</em></p>",t._borders=await new Promise((n=>{omnivore.kml(sources[e].kml,null,L.geoJson(null,{style:{color:"#0074D9",weight:2,opacity:.8}})).on("ready",(function(){this.addTo(t),t.fitBounds(this.getBounds()),n(this)}))}));const a=await fetch(sources[e].csv).then((e=>e.text())),c=Papa.parse(a,{header:!0}).data;for(let e of c){if(!e.LAT||!e.LON)continue;const t=e["Organization Name_CLEAN"],a=[+e.LAT,+e.LON],c="multiple spaces"===(e.isMultiple||"").toLowerCase()?i:r,l=L.marker(a,{title:t,icon:c}).bindPopup(`<strong>${t}</strong><br>${e.Address}`).on("click",(()=>{o.innerHTML=`<h4>${t}</h4><p>${e.Address}</p>`}));n.addLayer(l),s.push({name:t,marker:l})}t.addLayer(n)}function attachSearchLogic(e,t,n,s,o,r,i){s.addEventListener("click",(()=>{"1"===n.style.opacity?(n.style.width="0",n.style.opacity="0",o.style.display="none"):(n.style.width="200px",n.style.opacity="1",n.focus())})),n.addEventListener("input",(()=>{const s=n.value.trim().toLowerCase();if(o.innerHTML="",!s)return void(o.style.display="none");const r=t.filter((e=>e.name.toLowerCase().includes(s))).slice(0,10);if(r.length)return r.forEach((t=>{const s=document.createElement("div");s.textContent=t.name,s.style.padding="0.3rem",s.style.cursor="pointer",s.addEventListener("click",(()=>{e.setView(t.marker.getLatLng(),14),t.marker.openPopup(),n.value=t.name,o.style.display="none"})),o.appendChild(s)})),o.style.display="block";const a=`https://api.maptiler.com/geocoding/${encodeURIComponent(s)}.json?key=${i}&limit=5`;fetch(a).then((e=>e.ok?e.json():Promise.reject(e.status))).then((t=>{const s=t.features||[];if(!s.length)return o.style.display="none";s.forEach((t=>{const s=t.place_name,[r,i]=t.geometry.coordinates,a=document.createElement("div");a.textContent=s,a.style.padding="0.3rem",a.style.cursor="pointer",a.addEventListener("click",(()=>{e.setView([i,r],14),L.popup().setLatLng([i,r]).setContent(`<strong>Address:</strong><br>${s}`).openOn(e),n.value=s,o.style.display="none"})),o.appendChild(a)})),o.style.display="block"})).catch((e=>{console.error("geocode error",e),o.style.display="none"}))})),document.addEventListener("click",(e=>{n.contains(e.target)||s.contains(e.target)||(o.style.display="none")}))}

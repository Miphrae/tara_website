const sources={county1:{kml:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/borders_livermore.kml",csv:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/points_livermore.csv"},county2:{kml:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/borders_pleasanton.kml",csv:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/points_pleasanton.csv"},county3:{kml:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/borders.kml",csv:"https://cdn.jsdelivr.net/gh/miphrae/tara_website@v1.0.0/points.csv"}};function makePinIcon(e){return L.divIcon({html:`
    <svg width="24" height="36" viewBox="0 0 24 36">
      <path
        d="M12 0C7.038 0 3 4.038 3 9
           c0 7.5 9 27 9 27s9-19.5 9-27
           C21 4.038 16.962 0 12 0z"
        fill="${e}"/>
      <circle cx="12" cy="9" r="3" fill="#fff"/>
    </svg>`,className:"",iconSize:[24,36],iconAnchor:[12,36],popupAnchor:[0,-36]})}async function loadCounty(e,t,n,s,r,i,a){t._borders&&(t.removeLayer(t._borders),t._borders=null),n.clearLayers(),s.length=0,r.innerHTML=`<p><em>Click a marker on the map â†’ its name will go here.</em></p>`,t._borders=await new Promise(n=>{omnivore.kml(sources[e].kml,null,L.geoJson(null,{style:{color:"#0074D9",weight:2,opacity:.8}})).on("ready",function(){this.addTo(t),t.fitBounds(this.getBounds()),n(this)})});let o=await fetch(sources[e].csv).then(e=>e.text()),l=Papa.parse(o,{header:!0}).data;for(let c of l){if(!c.LAT||!c.LON)continue;let d=c["Organization Name_CLEAN"],p=[+c.LAT,+c.LON],h="multiple spaces"===(c.isMultiple||"").toLowerCase(),y=h?a:i,m=L.marker(p,{title:d,icon:y}).bindPopup(`<strong>${d}</strong><br>${c.Address}`).on("click",()=>{r.innerHTML=`<h4>${d}</h4><p>${c.Address}</p>`});n.addLayer(m),s.push({name:d,marker:m})}t.addLayer(n)}function attachSearchLogic(e,t,n,s,r,i,a){s.addEventListener("click",()=>{let e="1"===n.style.opacity;e?(n.style.width="0",n.style.opacity="0",r.style.display="none"):(n.style.width="200px",n.style.opacity="1",n.focus())}),n.addEventListener("input",()=>{let s=n.value.trim().toLowerCase();if(r.innerHTML="",!s){r.style.display="none";return}let i=t.filter(e=>e.name.toLowerCase().includes(s)).slice(0,10);if(i.length)return i.forEach(t=>{let s=document.createElement("div");s.textContent=t.name,s.style.padding="0.3rem",s.style.cursor="pointer",s.addEventListener("click",()=>{e.setView(t.marker.getLatLng(),14),t.marker.openPopup(),n.value=t.name,r.style.display="none"}),r.appendChild(s)}),r.style.display="block";let o=`https://api.maptiler.com/geocoding/${encodeURIComponent(s)}.json?key=${a}&limit=5`;fetch(o).then(e=>e.ok?e.json():Promise.reject(e.status)).then(t=>{let s=t.features||[];if(!s.length)return r.style.display="none";s.forEach(t=>{let s=t.place_name,[i,a]=t.geometry.coordinates,o=document.createElement("div");o.textContent=s,o.style.padding="0.3rem",o.style.cursor="pointer",o.addEventListener("click",()=>{e.setView([a,i],14),L.popup().setLatLng([a,i]).setContent(`<strong>Address:</strong><br>${s}`).openOn(e),n.value=s,r.style.display="none"}),r.appendChild(o)}),r.style.display="block"}).catch(e=>{console.error("geocode error",e),r.style.display="none"})}),document.addEventListener("click",e=>{n.contains(e.target)||s.contains(e.target)||(r.style.display="none")})}